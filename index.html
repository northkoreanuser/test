<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>해시 추첨 시스템</title>
    <style>
        /* 기존 CSS 코드는 동일하게 유지 */
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; line-height: 1.6; }
        .tab { overflow: hidden; border: 1px solid #ccc; background-color: #f1f1f1; border-radius: 4px 4px 0 0; }
        .tab button { background-color: inherit; float: left; border: none; outline: none; cursor: pointer; padding: 14px 16px; transition: 0.3s; font-size: 16px; }
        .tab button:hover { background-color: #ddd; }
        .tab button.active { background-color: #4CAF50; color: white; }
        .tabcontent { display: none; padding: 20px; border: 1px solid #ccc; border-top: none; border-radius: 0 0 4px 4px; animation: fadeEffect 1s; }
        @keyframes fadeEffect { from {opacity: 0;} to {opacity: 1;} }
        button.action-btn { background-color: #4CAF50; color: white; border: none; padding: 10px 15px; margin: 10px 2px; cursor: pointer; border-radius: 4px; }
        button.action-btn:hover { background-color: #45a049; }
        button.danger-btn { background-color: #f44336; color: white; border: none; padding: 10px 15px; margin: 10px 2px; cursor: pointer; border-radius: 4px; }
        button.danger-btn:hover { background-color: #da190b; }
        input[type="email"], input[type="text"].hash-display { width: calc(100% - 100px); /* 복사 버튼 공간 확보 */ padding: 10px; margin: 8px 0; box-sizing: border-box; border: 2px solid #ccc; border-radius: 4px; display: inline-block; vertical-align: middle; }
        button.copy-btn { background-color: #007bff; color: white; border: none; padding: 10px 15px; margin-left: 5px; cursor: pointer; border-radius: 4px; width: 90px; vertical-align: middle; }
        button.copy-btn:hover { background-color: #0056b3; }
        .result-box { margin-top: 20px; padding: 15px; border-radius: 4px; background-color: #f8ff8; }
        #hashLoading, #drawLoading { display: none; color: #4CAF50; margin: 10px 0; }
        .source-links, .file-links { margin-top: 30px; padding-top: 20px; border-top: 1px solid #eee; text-align: center; font-size: 0.9em; }
        .source-links a, .file-links a { color: #0366d6; text-decoration: none; margin: 0 5px; } /* 간격 조정 */
        .source-links a:hover, .file-links a:hover { text-decoration: underline; }
        .file-info-container { display: inline-block; margin-left: 5px; font-size: 0.9em; color: #888; } /* hash.txt 관련 정보 컨테이너 */

        /* 토스트 메시지 CSS */
        .toast-message {
            visibility: hidden;
            min-width: 250px;
            margin-left: -125px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 8px;
            padding: 16px;
            position: fixed;
            z-index: 1;
            left: 50%;
            bottom: 30px;
            font-size: 17px;
            opacity: 0; /* 초기 투명도 0 */
            transition: visibility 0s, opacity 0.5s linear; /* 부드러운 전환 */
        }

        .toast-message.show {
            visibility: visible;
            opacity: 1;
        }

        /* 복사된 해시 값이 길어질 경우의 스타일 조정 */
        input[type="text"].hash-display {
            /* 기존 스타일 유지 */
            word-break: break-all; /* 긴 해시 값이 잘리지 않고 다음 줄로 넘어갈 수 있도록 */
        }
    </style>
</head>
<body>
    <h1>해시 추첨 시스템</h1>

    <div class="tab">
        <button class="tablinks active" onclick="openTab(event, 'drawTab')">추첨</button>
        <button class="tablinks" onclick="openTab(event, 'checkTab')">당첨자 확인</button>
    </div>

    <div id="drawTab" class="tabcontent" style="display: block;">
        <button class="action-btn" onclick="drawWinner()">당첨자 추첨 실행</button>
        <button class="danger-btn" onclick="clearWinnerHistory()">추첨 이력 삭제 (테스트용)</button>
        <div id="drawLoading">추첨 진행 중...</div>
        <div id="result" class="result-box"></div>
        <p style="margin-top: 20px; font-size: 0.9em; color: #666;">
            * 모든 추첨 과정은 공개된 
            <span id="hashTxtLink_drawTab"></span>
            <span class="file-info-container">
                <span id="hashTxtCommitLink_drawTab"></span>
            </span>
            파일 데이터를 기반으로 합니다.
            이 파일은 GitHub 커밋 이력을 통해 조작 불가능함을 보증합니다.<br>
            <strong>추첨된 해시는 <a href="#" onclick="openTabAndFocus(event, 'checkTab'); return false;" style="color: #e94560; text-decoration: underline; font-weight: bold;">이곳은 당첨자 확인 탭이 아닙니다. 클릭하여 이동 후 확인해주세요.</a></strong>
            <strong>`test@test.com` 이메일은 시스템 시연을 위한 것으로, 실제 추첨 대상에서는 자동으로 제외됩니다.</strong>
        </p>
    </div>

    <div id="checkTab" class="tabcontent">
        <input type="email" id="emailInput" value="test@test.com" placeholder="이메일을 입력하세요">
        <button class="action-btn" onclick="generateAndCheckHash()">내 이메일 해시 확인</button>
        <div id="hashLoading">해시 생성 및 확인 중...</div>
        <div id="hashResult" class="result-box">
            <p><strong>입력된 이메일의 해시:</strong></p>
            <div style="display: flex; align-items: center;">
                <input type="text" id="userHashDisplay" class="hash-display" readonly>
                <button class="copy-btn" onclick="copyToClipboard('userHashDisplay', '해시가 복사되었습니다.')">복사</button>
            </div>
            <p id="hashVerificationResult"></p>
        </div>
        <p style="margin-top: 20px; font-size: 0.9em; color: #666;">
            💡 이메일 해시를 생성한 후, 투명한 응모 기록을 위해 <br>
            <span id="hashTxtLink_checkTab"></span>
            <span class="file-info-container">
                <span id="hashTxtCommitLink_checkTab"></span>
            </span>
            에서 직접 <span style="font-weight: bold; color: #e94560;">Ctrl+F (Mac: Cmd+F)</span>를 눌러 <br>
            생성된 해시가 목록에 있는지 검색하여 확인해 볼 수 있습니다.<br>
            <strong>추첨된 해시는 <a href="https://www.youtube.com/channel/UCG6kyr-hb_1vRaxYstH_8xw/posts" target="_blank" style="color: #4CAF50; text-decoration: underline; font-weight: bold;">이 유튜브 커뮤니티 게시글</a>에서 확인할 수 있습니다.</strong>
        </p>
    </div>

    <div class="source-links">
        <p>
            이 페이지의 소스코드 투명성을 확인하세요:
            <span id="indexSourceLinks"></span>
        </p>
    </div>

    <hr>
    <div style="padding: 20px; background-color: #f0f8ff; border-radius: 8px; margin-top: 30px;">
        <h2 style="color: #333; margin-top: 0;">조작된 추첨인가요?</h2>
        <p style="font-size: 0.95em; color: #555;">
            저희 해시 추첨 시스템은 <strong>투명성과 신뢰성</strong>을 최우선으로 합니다. 혹시 모를 조작 의혹에 대해 다음과 같이 설명 드립니다.
        </p>
        <ol style="font-size: 0.9em; color: #555;">
            <li>
                <strong><span class="hash-txt-name"></span> 파일 조작 의심:</strong>
                <span class="hash-txt-name"></span> 파일은 GitHub 저장소에 공개되어 있으며, 모든 <strong>수정 이력(커밋 이력)</strong>이 기록됩니다. 이는 파일이 언제, 누구에 의해, 어떻게 변경되었는지 투명하게 공개되어 <strong>의도적으로 조작되지 않았음</strong>을 의미합니다. 위 링크를 통해 직접 커밋 이력을 조회해 보세요.
            </li>
            <li>
                <strong>내 이메일을 넣어도 엉뚱한 해싱 결과가 나오게 조작되진 않았나요:</strong>
                저희 시스템은 이메일을 <strong>SHA-512</strong> 알고리즘으로 해싱합니다. 이 알고리즘은 전 세계적으로 널리 사용되며, 동일한 입력 값에는 항상 동일한 해시 값을 출력하는 <strong>단방향 암호화</strong> 방식입니다.
                따라서 '당첨자 확인' 탭에서 귀하의 이메일을 입력하여 생성된 해시 값이 엉뚱하게 조작될 가능성은 없습니다. 의심스럽다면, 다른 <strong>개별적인 SHA-512 온라인 도구</strong> (예: Google에 "SHA512 online tool" 검색)에 동일한 이메일을 넣어보세요. 동일한 해싱 결과가 출력될 것입니다. 또한, <span class="hash-txt-name"></span> 파일을 직접 다운로드하여 다른 프로그램으로 조회해 보셔도 좋습니다.
            </li>
            <li>
                <strong>이 페이지가 조작된건지 의심됩니다:</strong>
                이 페이지의 <strong>소스코드(`index.html`)</strong> 또한 GitHub 저장소에 공개되어 있으며, 마찬가지로 모든 <strong>커밋 이력</strong>을 확인할 수 있습니다. 페이지 하단의 <strong>"이 페이지의 소스코드 투명성을 확인하세요"</strong> 섹션에서 '수정 이력 확인' 링크를 클릭하여 직접 확인해 보세요. 이 페이지의 모든 동작 방식과 데이터 처리 로직을 검토할 수 있습니다.
            </li>
        </ol>
        <p style="font-size: 0.95em; color: #555; text-align: center; margin-top: 20px;">
            저희는 모든 과정이 투명하게 공개되도록 노력하고 있습니다. 안심하고 시스템을 이용해 주세요.
        </p>
    </div>

    <div id="toastMessage" class="toast-message"></div>

    <script>
        // --- 전역 변수 설정 ---
        const HASH_FILE_NAME = 'e-mail.txt'; // hash.txt 파일 이름을 변수로 정의

        // --- 유틸리티 함수 ---
        function setCookie(name, value, days) {
            let expires = "";
            if (days) {
                let date = new Date();
                date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
                expires = "; expires=" + date.toUTCString();
            }
            document.cookie = name + "=" + (value || "")  + expires + "; path=/";
        }

        function getCookie(name) {
            let nameEQ = name + "=";
            let ca = document.cookie.split(';');
            for(let i=0; i < ca.length; i++) {
                let c = ca[i];
                while (c.charAt(0) === ' ') c = c.substring(1, c.length);
                if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
            }
            return null;
        }

        function eraseCookie(name) {
            document.cookie = name + '=; Max-Age=-99999999; path=/';
        }

        // 텍스트를 클립보드에 복사하는 함수 (토스트 메시지 사용)
        function copyToClipboard(elementId, message) {
            const copyText = document.getElementById(elementId);
            copyText.select();
            copyText.setSelectionRange(0, 99999); // 모바일용
            try {
                document.execCommand("copy");
                showToast(message); // 토스트 메시지 표시
            } catch (err) {
                console.error('클립보드 복사 실패:', err);
                alert("복사에 실패했습니다. 수동으로 복사해주세요.");
            }
        }

        // 토스트 메시지 표시 함수
        function showToast(message) {
            const toast = document.getElementById("toastMessage");
            toast.textContent = message;
            toast.className = "toast-message show";
            setTimeout(function(){ 
                toast.className = toast.className.replace("show", ""); 
            }, 3000); // 3초 후 사라짐
        }


        // --- 해시 및 추첨 로직 ---

        // SHA-512 해시 생성 함수
        async function generateSHA512(message) {
            try {
                const encoder = new TextEncoder();
                const data = encoder.encode(message);
                const hashBuffer = await crypto.subtle.digest('SHA-512', data);
                return Array.from(new Uint8Array(hashBuffer)).map(b => b.toString(16).padStart(2, '0')).join('');
            } catch (error) {
                console.error("SHA-512 오류:", error);
                throw new Error("해시 생성에 실패했습니다. 이 기능을 사용하려면 HTTPS 환경이 필요합니다.");
            }
        }

        // test@test.com 의 해시를 미리 계산하여 저장
        let TEST_EMAIL_HASH = '';
        (async () => {
            try {
                TEST_EMAIL_HASH = await generateSHA512('test@test.com');
            } catch (e) {
                console.error("테스트 이메일 해시 생성 실패:", e);
            }
        })();


        // 해시 생성 및 확인 함수
        async function generateAndCheckHash() {
            const email = document.getElementById('emailInput').value.trim();
            if (!email) {
                alert('이메일을 입력해주세요.');
                return;
            }

            const loader = document.getElementById('hashLoading');
            const userHashDisplay = document.getElementById('userHashDisplay');
            const hashVerificationResult = document.getElementById('hashVerificationResult');

            loader.style.display = 'block';
            userHashDisplay.value = ''; // 기존 값 초기화
            hashVerificationResult.innerHTML = ''; // 기존 값 초기화

            try {
                const userHash = await generateSHA512(email);
                userHashDisplay.value = userHash; // 해시 값을 입력 필드에 표시

                // hash.txt를 Raw URL로 Fetch
                const hashTxtRawLink = document.getElementById('hashTxtLink_checkTab').querySelector('a').href; // 현재 페이지에 삽입된 hash.txt Raw 링크를 가져옴
                const response = await fetch(hashTxtRawLink); // Raw URL로 fetch
                if (!response.ok) {
                    throw new Error("응모 해시 목록을 불러올 수 없습니다. (Network Error or File Not Found)");
                }
                const hashesInFile = (await response.text()).split('\n').map(h => h.trim()).filter(h => h);

                let found = false;
                if (hashesInFile.includes(userHash)) {
                    found = true;
                }

                hashVerificationResult.innerHTML = `
                    <p style="color: ${found ? 'green' : 'red'}; font-weight: bold;">
                        ${found ? '✅ 귀하의 해시가 응모 목록에 있습니다.' : '❌ 귀하의 해시가 응모 목록에 없습니다.'}
                    </p>
                `;
                // 당첨자 확인 결과 내 중첩된 hash.txt 링크 (없을 경우)
                if (!found) {
                    hashVerificationResult.innerHTML += `
                        <p style="font-size: 0.95em; margin-top: 15px; color: #888;">
                            혹시 오타가 없는지 확인하거나, 모든 응모 기록이 담긴 <br>
                            <span id="hashTxtLink_checkTab_nested"></span> <span class="file-info-container">
                                <span id="hashTxtCommitLink_checkTab_nested"></span> </span>
                            에서 직접 <span style="font-weight: bold; color: #e94560;">Ctrl+F (Mac: Cmd+F)</span>를 눌러 <br>
                            생성된 해시가 목록에 있는지 검색하여 확인해 보세요.
                        </p>
                    `;
                } else {
                     hashVerificationResult.innerHTML += `
                        <p style="font-size: 0.85em; margin-top: 10px; color: #a0a0a0;">
                            더 자세한 확인을 원하시면 
                            <span id="hashTxtLink_checkTab_nested_found"></span> <span class="file-info-container">
                                <span id="hashTxtCommitLink_checkTab_nested_found"></span> </span>
                            을 열어 직접 검색할 수 있습니다.
                        </p>
                    `;
                }
                // generateGitHubLinks를 다시 호출하여 동적 링크 업데이트
                generateGitHubLinks(); 
            } catch (error) {
                hashVerificationResult.innerHTML = `<p style="color:red;">오류 발생: ${error.message}</p>`;
                userHashDisplay.value = '';
            } finally {
                loader.style.display = 'none';
            }
        }

        // 당첨자 추첨 함수
        async function drawWinner() {
            const loader = document.getElementById('drawLoading');
            const resultDiv = document.getElementById('result');

            loader.style.display = 'block';
            resultDiv.innerHTML = '';

            try {
                let winnerHash = getCookie('lastWinnerHash');
                let isLoadedFromCookie = false;

                // hash.txt를 Raw URL로 Fetch
                const hashTxtRawLink = document.getElementById('hashTxtLink_drawTab').querySelector('a').href; // 현재 페이지에 삽입된 hash.txt Raw 링크를 가져옴
                const response = await fetch(hashTxtRawLink); // Raw URL로 fetch
                if (!response.ok) {
                    throw new Error("응모 해시 목록을 불러올 수 없습니다. (Network Error or File Not Found)");
                }
                let hashes = (await response.text()).split('\n').map(h => h.trim()).filter(h => h);

                if (TEST_EMAIL_HASH) {
                    hashes = hashes.filter(h => h !== TEST_EMAIL_HASH);
                }
                
                if (!hashes.length) {
                    throw new Error("추첨 가능한 해시가 없습니다. (유효한 응모자가 없는 경우)");
                }

                const totalEligibleHashes = hashes.length;

                if (!winnerHash || !hashes.includes(winnerHash)) {
                    if (winnerHash && !hashes.includes(winnerHash)) {
                        console.warn("쿠키에 저장된 당첨 해시가 현재 추첨 가능한 목록에 없어 새로운 추첨을 진행합니다.");
                    }
                    const randomIndex = Math.floor(Math.random() * hashes.length);
                    winnerHash = hashes[randomIndex];
                    setCookie('lastWinnerHash', winnerHash, 7);
                } else {
                    isLoadedFromCookie = true;
                }

                // 결과 박스에 해시 입력 필드와 복사 버튼 추가
                resultDiv.innerHTML = `
                    <p><strong>총 응모 해시 수:</strong> ${totalEligibleHashes}개</p>
                    <p style="font-size: 1.2em; color: #4CAF50; font-weight: bold;">
                        ✨ 추첨된 해시:
                    </p>
                    <div style="display: flex; align-items: center;">
                        <input type="text" id="winnerHashDisplay" class="hash-display" value="${winnerHash}" readonly>
                        <button class="copy-btn" onclick="copyToClipboard('winnerHashDisplay', '당첨 해시가 복사되었습니다.')">복사</button>
                    </div>
                `;
                if (isLoadedFromCookie) {
                    resultDiv.innerHTML += '<p style="color: blue; font-size: 0.85em; margin-top: 10px;">(이전 추첨 결과가 쿠키에서 로드되었습니다.)</p>';
                }
                // generateGitHubLinks를 다시 호출하여 동적 링크 업데이트
                generateGitHubLinks();

            } catch (error) {
                resultDiv.innerHTML = `<p style="color:red;">${error.message}</p>`;
            } finally {
                loader.style.display = 'none';
            }
        }

        // 추첨 이력 제거 함수
        function clearWinnerHistory() {
            if (confirm("정말 추첨 이력을 삭제하시겠습니까? (로컬 브라우저 쿠키에서만 삭제되며, 새로고침 시 다시 추첨 가능)")) {
                eraseCookie('lastWinnerHash');
                document.getElementById('result').innerHTML = '<p style="color: green;">추첨 이력이 삭제되었습니다. 이제 새로운 추첨을 실행할 수 있습니다.</p>';
                console.log("추첨 이력 쿠키가 삭제되었습니다.");
            }
        }

        // 탭 전환 함수
        function openTab(evt, tabName) {
            document.querySelectorAll('.tabcontent').forEach(tab => tab.style.display = 'none');
            document.querySelectorAll('.tablinks').forEach(btn => btn.classList.remove('active'));
            document.getElementById(tabName).style.display = 'block';
            
            // 클릭된 탭 버튼 활성화
            if (evt && evt.currentTarget) {
                evt.currentTarget.classList.add('active');
            } else { // 코드에서 직접 호출하는 경우 (예: openTabAndFocus)
                const targetButton = Array.from(document.querySelectorAll('.tablinks'))
                                        .find(btn => btn.textContent.includes(tabName === 'drawTab' ? '추첨' : '당첨자 확인'));
                if (targetButton) {
                    targetButton.classList.add('active');
                }
            }
        }
        
        // 탭을 열고 특정 탭 버튼에 포커스하는 함수 (클릭 이벤트가 없을 때 사용)
        function openTabAndFocus(event, tabName) {
            // openTab 함수를 호출하여 탭을 전환
            openTab(null, tabName); // 첫 번째 인자에 null을 넘겨서 event 객체가 없음을 알림

            // 특정 탭 버튼에 포커스를 맞춤 (선택 사항)
            const targetButton = Array.from(document.querySelectorAll('.tablinks'))
                                    .find(btn => btn.textContent.includes(tabName === 'drawTab' ? '추첨' : '당첨자 확인'));
            if (targetButton) {
                targetButton.focus();
            }
        }


        // GitHub 소스코드 및 파일 이력 링크 생성 함수
        function generateGitHubLinks() {
            const currentUrl = window.location.href;
            const urlParts = currentUrl.split('/');
            
            let userName = '';
            let repoName = '';

            // GitHub Pages 주소 (예: https://user.github.io/repo/index.html)
            if (urlParts[2] && urlParts[2].endsWith('.github.io')) {
                userName = urlParts[2].split('.')[0];
                repoName = urlParts[3] || userName; // user.github.io/ -> repoName = user, user.github.io/repo -> repoName = repo
            } 
            // GitHub 저장소 직접 접근 주소 (예: https://github.com/user/repo/blob/main/index.html)
            else if (urlParts[2] === 'github.com' && urlParts[3] && urlParts[4]) {
                userName = urlParts[3];
                repoName = urlParts[4];
            } else {
                // 로컬 파일 등, GitHub Pages/Repo 형태가 아닌 경우 링크 생성 생략
                const indexLinksDiv = document.getElementById('indexSourceLinks');
                if (indexLinksDiv) {
                    indexLinksDiv.innerHTML = '로컬 환경 또는 비 GitHub Pages/Repo 주소에서는 소스코드 링크를 생성할 수 없습니다.';
                }
                // hash.txt 관련 링크들도 비활성화
                const hashTxtLinkDraw = document.getElementById('hashTxtLink_drawTab');
                if (hashTxtLinkDraw) hashTxtLinkDraw.innerHTML = HASH_FILE_NAME; // 변수 사용
                const hashTxtCommitLinkDraw = document.getElementById('hashTxtCommitLink_drawTab');
                if (hashTxtCommitLinkDraw) hashTxtCommitLinkDraw.innerHTML = '';
                
                const hashTxtLinkCheck = document.getElementById('hashTxtLink_checkTab');
                if (hashTxtLinkCheck) hashTxtLinkCheck.innerHTML = `${HASH_FILE_NAME} 파일`; // 변수 사용
                const hashTxtCommitLinkCheck = document.getElementById('hashTxtCommitLink_checkTab');
                if (hashTxtCommitLinkCheck) hashTxtCommitLinkCheck.innerHTML = '';

                const hashTxtLinkCheckNested = document.getElementById('hashTxtLink_checkTab_nested');
                if (hashTxtLinkCheckNested) hashTxtLinkCheckNested.innerHTML = `${HASH_FILE_NAME} 파일`; // 변수 사용
                const hashTxtCommitLinkCheckNested = document.getElementById('hashTxtCommitLink_checkTab_nested');
                if (hashTxtCommitLinkCheckNested) hashTxtCommitLinkCheckNested.innerHTML = '';
                
                const hashTxtLinkCheckNestedFound = document.getElementById('hashTxtLink_checkTab_nested_found');
                if (hashTxtLinkCheckNestedFound) hashTxtLinkCheckNestedFound.innerHTML = HASH_FILE_NAME; // 변수 사용
                const hashTxtCommitLinkCheckNestedFound = document.getElementById('hashTxtCommitLink_checkTab_nested_found');
                if (hashTxtCommitLinkCheckNestedFound) hashTxtCommitLinkCheckNestedFound.innerHTML = '';

                // 조작된 추첨인가요? 섹션의 hash.txt 이름 업데이트
                document.querySelectorAll('.hash-txt-name').forEach(el => {
                    el.innerHTML = `<strong>${HASH_FILE_NAME}</strong>`;
                });
                return;
            }

            const branch = 'main'; // 기본 브랜치 이름 (필요시 변경 가능)
            const indexFileName = 'index.html';
            // const hashTxtFileName = 'hash.txt'; // HASH_FILE_NAME 전역 변수 사용

            // --- index.html 관련 링크 ---
            const githubViewLink = `https://github.com/${userName}/${repoName}/blob/${branch}/${indexFileName}`;
            const githubRawLink = `https://raw.githubusercontent.com/${userName}/${repoName}/refs/heads/${branch}/${indexFileName}`; // 정확한 Raw 코드 링크
            const githubCommitLink = `https://github.com/${userName}/${repoName}/commits/${branch}/${indexFileName}`;

            const indexLinksDiv = document.getElementById('indexSourceLinks');
            if (indexLinksDiv) {
                indexLinksDiv.innerHTML = `
                    <a href="${githubViewLink}" target="_blank">GitHub에서 보기</a> |
                    <a href="${githubRawLink}" target="_blank">Raw 코드 직접 보기</a> |
                    <a href="${githubCommitLink}" target="_blank">수정 이력 확인</a>
                `;
            }

            // --- hash.txt 관련 링크 (기본 링크를 Raw URL로 교체) ---
            const hashTxtRawUrl = `https://raw.githubusercontent.com/${userName}/${repoName}/refs/heads/${branch}/${HASH_FILE_NAME}`; // 변수 사용
            const hashTxtCommitLink = `https://github.com/${userName}/${repoName}/commits/${branch}/${HASH_FILE_NAME}`; // 변수 사용
            
            const hashTxtMainLinkHtml = `<a href="${hashTxtRawUrl}" target="_blank">${HASH_FILE_NAME}</a>`; // 변수 사용
            // <strong> 태그를 사용하도록 변경
            const hashTxtMainLinkHtmlBold = `<a href="${hashTxtRawUrl}" target="_blank" style="color: #4CAF50; text-decoration: underline; font-weight: bold;"><strong>${HASH_FILE_NAME} 파일</strong></a>`; // 변수 사용 + 볼드 스타일 유지
            const hashTxtCommitLinkHtml = `(<a href="${hashTxtCommitLink}" target="_blank">수정 이력 확인</a>)`;

            // 추첨 탭의 hash.txt 링크
            const hashTxtLinkDraw = document.getElementById('hashTxtLink_drawTab');
            if (hashTxtLinkDraw) hashTxtLinkDraw.innerHTML = hashTxtMainLinkHtml;
            const hashTxtCommitLinkDraw = document.getElementById('hashTxtCommitLink_drawTab');
            if (hashTxtCommitLinkDraw) hashTxtCommitLinkDraw.innerHTML = hashTxtCommitLinkHtml;

            // 당첨자 확인 탭의 hash.txt 링크 (메인 설명)
            const hashTxtLinkCheck = document.getElementById('hashTxtLink_checkTab');
            if (hashTxtLinkCheck) hashTxtLinkCheck.innerHTML = hashTxtMainLinkHtmlBold;
            const hashTxtCommitLinkCheck = document.getElementById('hashTxtCommitLink_checkTab');
            if (hashTxtCommitLinkCheck) hashTxtCommitLinkCheck.innerHTML = hashTxtCommitLinkHtml;

            // 당첨자 확인 결과 내 중첩된 hash.txt 링크 (없을 경우)
            const hashTxtLinkCheckNested = document.getElementById('hashTxtLink_checkTab_nested');
            if (hashTxtLinkCheckNested) hashTxtLinkCheckNested.innerHTML = hashTxtMainLinkHtmlBold;
            const hashTxtCommitLinkCheckNested = document.getElementById('hashTxtCommitLink_checkTab_nested');
            if (hashTxtCommitLinkCheckNested) hashTxtCommitLinkCheckNested.innerHTML = hashTxtCommitLinkHtml;

            // 당첨자 확인 결과 내 중첩된 hash.txt 링크 (있을 경우)
            const hashTxtLinkCheckNestedFound = document.getElementById('hashTxtLink_checkTab_nested_found');
            if (hashTxtLinkCheckNestedFound) hashTxtLinkCheckNestedFound.innerHTML = hashTxtMainLinkHtml; // 볼드 스타일 제외
            const hashTxtCommitLinkCheckNestedFound = document.getElementById('hashTxtCommitLink_checkTab_nested_found');
            if (hashTxtCommitLinkCheckNestedFound) hashTxtCommitLinkCheckNestedFound.innerHTML = hashTxtCommitLinkHtml;

            // 조작된 추첨인가요? 섹션의 hash.txt 이름 업데이트
            document.querySelectorAll('.hash-txt-name').forEach(el => {
                el.innerHTML = `<strong>${HASH_FILE_NAME}</strong>`; // <strong> 태그 사용
            });
        }


        // 페이지 로드 시 첫 번째 탭 열기 및 GitHub 링크 생성
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelector('.tablinks.active').click();
            generateGitHubLinks(); // GitHub 소스코드 및 파일 이력 링크 생성 함수 호출
        });
    </script>
</body>
</html>
